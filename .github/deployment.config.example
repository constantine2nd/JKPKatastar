#!/bin/bash
# JKP Katastar - Example Deployment Configuration
# Copy this file to 'deployment.config' and customize for your environment
# cp deployment.config.example deployment.config

# =============================================================================
# SERVER CONFIGURATION - CUSTOMIZE THESE VALUES
# =============================================================================

# Your VPS Server Details
export VPS_HOST="your.vps.ip.address"           # Replace with your VPS IP
export VPS_USER="root"                          # SSH user (usually root)
export VPS_PORT="22"                            # SSH port

# =============================================================================
# PROJECT CONFIGURATION - USUALLY DON'T NEED TO CHANGE
# =============================================================================

# Project Details
export PROJECT_NAME="JKPKatastar"
export GITHUB_REPOSITORY="your-username/JKPKatastar"  # Update if you forked
export DEFAULT_BRANCH="main"

# Directory Structure
export DEPLOY_DIR="/opt/jkp-katastar"
export DATA_DIR="/opt/jkp-katastar/data"
export LOGS_DIR="/opt/jkp-katastar/logs"
export BACKUP_DIR="/opt/jkp-katastar/backups"

# =============================================================================
# APPLICATION CONFIGURATION
# =============================================================================

# Service Ports - Change if you have conflicts
export FRONTEND_PORT="3000"
export BACKEND_PORT="5000"
export MONGODB_PORT="27017"

# Application Environment
export NODE_ENV="production"                    # production, staging, development
export MONGO_DATABASE="graves_prod"            # Database name
export MONGO_USERNAME="admin"                  # MongoDB admin user

# Map Center Coordinates (Temerin, Serbia by default)
export MAP_CENTER_LAT="45.2671"
export MAP_CENTER_LON="19.8335"

# =============================================================================
# DEPLOYMENT CONFIGURATION
# =============================================================================

# Docker Settings
export COMPOSE_PROJECT_NAME="jkp-katastar"
export DOCKER_BUILDKIT="1"

# Deployment Timing (in seconds)
export DEPLOYMENT_TIMEOUT="300"                # 5 minutes
export SERVICE_STARTUP_WAIT="60"               # 1 minute
export HEALTH_CHECK_RETRIES="30"               # 30 attempts
export HEALTH_CHECK_INTERVAL="5"               # 5 seconds between checks

# Backup Settings
export BACKUP_RETENTION_COUNT="3"              # Keep last 3 backups
export AUTO_BACKUP_BEFORE_DEPLOY="true"        # Backup before deployment

# =============================================================================
# MONITORING CONFIGURATION
# =============================================================================

# Resource Requirements (in MB)
export MIN_MEMORY_MB="256"                     # Minimum RAM
export MIN_DISK_MB="2048"                      # Minimum disk space (2GB)
export DISK_WARNING_THRESHOLD="85"             # Warn when disk usage > 85%

# Docker Logging
export LOG_MAX_SIZE="10m"                      # Max log file size
export LOG_MAX_FILES="3"                       # Number of log files to keep

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================

# SSH Key Settings
export SSH_KEY_PATH="~/.ssh/github_actions"
export SSH_KEY_COMMENT="github-actions@jkp-katastar"

# Firewall Ports (space-separated)
export ALLOWED_PORTS="22 3000 5000"

# =============================================================================
# ENVIRONMENT OVERRIDES
# =============================================================================

# Uncomment and modify for different environments:

# Development Environment
# if [ "${ENVIRONMENT}" = "development" ]; then
#     export NODE_ENV="development"
#     export MONGO_DATABASE="graves_dev"
#     export VPS_HOST="localhost"
# fi

# Staging Environment
# if [ "${ENVIRONMENT}" = "staging" ]; then
#     export NODE_ENV="staging"
#     export MONGO_DATABASE="graves_staging"
#     export VPS_HOST="staging.yourdomain.com"
#     export FRONTEND_PORT="3001"
#     export BACKEND_PORT="5001"
# fi

# =============================================================================
# EXAMPLES FOR DIFFERENT SETUPS
# =============================================================================

# Example 1: Digital Ocean Droplet
# export VPS_HOST="your-droplet-ip"
# export VPS_USER="root"

# Example 2: AWS EC2 Instance
# export VPS_HOST="ec2-xx-xx-xx-xx.compute-1.amazonaws.com"
# export VPS_USER="ubuntu"

# Example 3: Custom Domain
# export VPS_HOST="your-domain.com"
# export FRONTEND_URL="https://your-domain.com"
# export BACKEND_URL="https://api.your-domain.com"
# export API_URL="https://api.your-domain.com/api"

# Example 4: Different Ports (if 3000/5000 are taken)
# export FRONTEND_PORT="8080"
# export BACKEND_PORT="8000"

# =============================================================================
# VALIDATION AND HELP
# =============================================================================

# Function to show help
show_help() {
    echo "üèõÔ∏è  JKP Katastar Configuration Help"
    echo "=================================="
    echo ""
    echo "1. Copy this file: cp deployment.config.example deployment.config"
    echo "2. Edit deployment.config with your settings:"
    echo "   - Set VPS_HOST to your server IP address"
    echo "   - Set GITHUB_REPOSITORY if you forked the project"
    echo "   - Adjust ports if needed"
    echo ""
    echo "3. Validate configuration:"
    echo "   source deployment.config validate"
    echo ""
    echo "4. View configuration:"
    echo "   source deployment.config show"
    echo ""
    echo "Required GitHub Secrets:"
    echo "  VPS_HOST, VPS_USER, VPS_SSH_KEY"
    echo "  MONGO_PASSWORD, JWT_SECRET"
    echo "  CLIENT_HOST_URI, REACT_APP_API_URL"
    echo ""
}

# Show help if run directly
if [ "${BASH_SOURCE[0]}" = "${0}" ]; then
    show_help
fi
